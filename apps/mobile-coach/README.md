# RidePulse Mobile Coach

Android приложение для тренеров для мониторинга метрик велосипедистов в реальном времени.

## Функции

- **Авторизация** с ролевой моделью (Coach, Admin)
- **Просмотр списка райдеров** команды
- **Real-time метрики** райдеров через WebSocket
- **Детальный просмотр** метрик конкретного райдера:
  - Пульс (bpm)
  - Мощность (W)
  - Каденс (rpm)
  - Скорость (км/ч)
- **Система алертов** с возможностью подтверждения
- **Фильтрация** активных райдеров

## Ролевая модель

### Coach (Тренер)
- Просмотр райдеров своей команды
- Просмотр метрик всех райдеров
- Просмотр и подтверждение алертов
- Доступ к аналитике

### Admin (Администратор)
- Все права тренера
- Управление пользователями
- Управление командами
- Настройка порогов алертов

## Стек технологий

- **Kotlin** — основной язык
- **Jetpack Compose** — UI
- **Hilt** — Dependency Injection
- **Coroutines + Flow** — асинхронное программирование
- **Socket.IO Client** — WebSocket клиент
- **Shared Types** — общие типы с backend

## Структура проекта

```
src/main/java/com/ridepulse/coach/
├── data/
│   ├── api/              # API клиенты
│   │   ├── AuthApi.kt
│   │   └── RidersApi.kt
│   └── websocket/        # WebSocket клиент
│       └── WebSocketClient.kt
├── ui/
│   ├── screens/          # UI экраны
│   │   ├── LoginScreen.kt
│   │   ├── DashboardScreen.kt
│   │   └── RiderDetailScreen.kt
│   ├── theme/            # Тема
│   └── viewmodel/        # ViewModel
│       ├── AuthViewModel.kt
│       ├── DashboardViewModel.kt
│       └── RiderDetailViewModel.kt
└── MainActivity.kt
```

## Сборка и запуск

### Требования

- Android Studio Hedgehog (2023.1.1) или новее
- JDK 17
- Android SDK 34
- Устройство с Android 8.0+ (API 26)

### Сборка

```bash
./gradlew assembleDebug
```

### Установка на устройство

```bash
./gradlew installDebug
```

### Запуск через Android Studio

1. Откройте проект в Android Studio
2. Подключите Android устройство
3. Нажмите Run или используйте `./gradlew installDebug`

## Конфигурация

URL сервера настраивается в `build.gradle.kts`:

```kotlin
debug {
    buildConfigField("String", "WS_URL", "\"ws://10.0.2.2:8080/ws\"")
    buildConfigField("String", "API_URL", "\"http://10.0.2.2:3000\"")
}
```

## Использование

### Регистрация

1. Запустите приложение
2. Нажмите "Нет аккаунта? Регистрация"
3. Заполните форму:
   - Имя
   - Email
   - Пароль
   - Роль (Тренер или Администратор)
4. Нажмите "Зарегистрироваться"

### Вход

1. Введите email и пароль
2. Нажмите "Войти"

### Мониторинг райдеров

1. После входа вы увидите список всех райдеров
2. Используйте фильтр "Только активные" для просмотра активных райдеров
3. Нажмите на райдера для просмотра детальной информации

### Детали райдера

На экране деталей отображаются:
- Информация о райдере
- Текущие метрики (пульс, мощность, каденс, скорость)
- История метрик
- Активные алерты

### Алерты

- Красный индикатор в заголовке показывает количество неподтверждённых алертов
- Нажмите на алерт для подтверждения (для тренеров и админов)

## API endpoints

- `POST /api/auth/register` — Регистрация
- `POST /api/auth/login` — Вход
- `GET /api/auth/me` — Текущий пользователь
- `GET /api/riders` — Список райдеров (для тренеров и админов)

## WebSocket события

### Получаемые события:
- `rider_metrics` — Обновление метрик райдера
- `alert` — Новый алерт
- `session_start` — Начало сессии
- `session_end` — Конец сессии

### Отправляемые события:
- `acknowledge_alert` — Подтверждение алерта
- `subscribe_rider` — Подписка на райдера
- `unsubscribe_rider` — Отписка от райдера

## Разрешения

Приложение требует следующие разрешения:
- `INTERNET` — работа с сетью
- `ACCESS_NETWORK_STATE` — проверка состояния сети
- `POST_NOTIFICATIONS` — показ уведомлений

## Безопасность

- JWT токены для аутентификации
- Refresh токены для обновления access токенов
- Проверка прав доступа на сервере
- HTTPS в production (настроить в build.gradle.kts)

## Отладка

Логи приложения доступны в Logcat с тегами:
- `RidePulseCoach` — основное приложение
- `AuthViewModel` — аутентификация
- `DashboardViewModel` — дашборд
- `WebSocketClient` — WebSocket соединение

## Лицензия

MIT
